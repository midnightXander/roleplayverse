{% extends "users/user/user_page.html"%}
{% load i18n %}




{% block filterContent %}

<!-- Content area for filtered results -->
<div id="filteredContent" class="bg-gray-700 rounded-lg p-6">
    
    <div id="statsSection" class="hidden">
        <h2 class="text-2xl font-bold mb-4">{% trans 'Statistiques' %} </h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            <!-- Stat cards will be dynamically inserted here -->
        </div>
    </div>
    
</div>




{% block active %}
<script>
    $(()=>{
        $('.filter-button').removeClass('active')
        $('.filter-button')[2].classList.add('active')
    })
</script>
{% endblock active %}



{% block fetchContent %}
<script>
    // ... (keep the existing script content)

   

    

    function showStats() {
        statsSection.classList.remove('hidden');
        // battlesList.classList.add('hidden');
        // requestsList.classList.add('hidden');
        // defaultMessage.classList.add('hidden');
        
        // Sample player stats data (replace with actual data from your backend)
        const playerStats = {
            totalBattles: '{{total_battles}}',
            wins: '{{total_wins}}',
            losses: '{{total_losses}}',
            draws: 10,
            winRate: '{{win_rate}}',
            avgBattleDuration: "15m 30s",
            battlesPerMonth: 12,
            pointsPerMonth: 250,
            currentRank: "{{player.rank}}",
            favoriteCharacter: "{{favorite_character}}",
            missions: {
                completed: 200,
                failed: 5,
                ongoing: 3
            },
            specialAchievements: [
                // "Chunin Exam Champion",
                // "S-Rank Mission Survivor",
                // "Kage's Apprentice"
            ]
        };

        const statCards = [
            createStatCard("Combats", playerStats.totalBattles, "fas fa-fist-raised"),
            createStatCard("Victoire", playerStats.wins, "fas fa-trophy"),
            createStatCard("Defaites", playerStats.losses, "fas fa-times-circle"),
            // createStatCard("Draws", playerStats.draws, "fas fa-equals"),
            createStatCard("Ratio de Victoire", `${playerStats.winRate}%`, "fas fa-percentage"),
            // createStatCard("Avg. Battle Duration", playerStats.avgBattleDuration, "fas fa-hourglass-half"),
            // createStatCard("Battles per Month", playerStats.battlesPerMonth, "fas fa-calendar-alt"),
            // createStatCard("Progression p/m", playerStats.pointsPerMonth, "fas fa-star"),
            createStatCard("Rang Actuel", playerStats.currentRank, "fas fa-user-ninja"),
            createStatCard("Personnage Favoris", playerStats.favoriteCharacter, "fas fa-bolt"),
            // createMissionsCard(playerStats.missions),
            createAchievementsCard(playerStats.specialAchievements)
        ].join('');

        statsSection.querySelector('.grid').innerHTML = statCards;
    }

    function createStatCard(title, value, icon) {
        return `
            <div class="stat-card bg-gray-800 rounded-lg p-4 shadow-lg">
                <div class="flex items-center mb-2">
                    <i class="${icon} text-orange-500 text-2xl mr-2"></i>
                    <h3 class="text-lg font-bold">${title}</h3>
                </div>
                <p class="text-2xl font-bold text-indigo-300">${value}</p>
            </div>
        `;
    }

    function createMissionsCard(missions) {
        return `
            <div class="stat-card bg-gray-800 rounded-lg p-4 shadow-lg col-span-1 md:col-span-2 lg:col-span-3">
                <div class="flex items-center mb-2">
                    <i class="fas fa-scroll text-indigo-400 text-2xl mr-2"></i>
                    <h3 class="text-lg font-bold">Missions</h3>
                </div>
                <div class="flex justify-between">
                    <p><span class="font-bold text-green-400">${missions.completed}</span> Completed</p>
                    <p><span class="font-bold text-red-400">${missions.failed}</span> Failed</p>
                    <p><span class="font-bold text-yellow-400">${missions.ongoing}</span> Ongoing</p>
                </div>
            </div>
        `;
    }

    function createAchievementsCard(achievements) {
        return `
            <div class="stat-card bg-gray-800 rounded-lg p-4 shadow-lg col-span-1 md:col-span-2 lg:col-span-3">
                <div class="flex items-center mb-2">
                    <i class="fas fa-medal text-indigo-400 text-2xl mr-2"></i>
                    <h3 class="text-lg font-bold">Achievements</h3>
                </div>
                <ul class="list-disc list-inside">
                    ${achievements.map(achievement => `<li class="text-indigo-300">${achievement}</li>`).join('')}
                </ul>
            </div>
        `;
    }

    // Initialize with battles shown
    showStats();
</script>
{% endblock fetchContent %}


{% endblock filterContent %}


{% block not_filterContent %}
<!-- Content area for filtered results -->
<div id="filteredContent" class="bg-gray-700 rounded-lg p-6">
    <!-- ... (keep existing content for battles, requests, and stats) ... -->
    <div id="chatsSection" class="hidden">
        <div class="flex flex-col md:flex-row h-[600px]">
            <!-- Inbox -->
            <div id="inbox" class="w-full md:w-1/3 bg-gray-800 rounded-lg overflow-hidden">
                <div class="p-4 bg-gray-900">
                    <h2 class="text-2xl font-bold">Inbox</h2>
                </div>
                <div class="overflow-y-auto h-[calc(100%-4rem)]" id="chatList">
                    <!-- Chat list items will be inserted here -->
                </div>
            </div>
            
            <!-- Chat Window -->
            <div id="chatWindow" class="hidden md:flex flex-col w-full md:w-2/3 bg-gray-800 rounded-lg ml-0 md:ml-4 mt-4 md:mt-0">
                <div id="chatHeader" class="p-4 bg-gray-900">
                    <h3 class="text-xl font-bold">Select a chat</h3>
                </div>
                <div id="chatMessages" class="flex-grow overflow-y-auto p-4">
                    <!-- Chat messages will be inserted here -->
                </div>
                <div class="p-4 bg-gray-900">
                    <form id="messageForm" class="flex">
                        <input type="text" id="messageInput" class="flex-grow p-2  rounded-l-full focus:outline-none bg-gray-700 text-white" placeholder="Type your message...">
                        <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white rounded-r-lg px-4 py-2 transition duration-300">Send</button>
                    </form>
                </div>
            </div>
        </div>
        <!-- Mobile chat toggle button -->
        <button id="mobileChatToggle" class="md:hidden mt-4 w-full bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg px-4 py-2 transition duration-300">
            Toggle Chat Window
        </button>
    </div>
   
</div>




{% block not_fetchContent %}
<script>
    // ... (keep the existing script content)

    // Filter functionality
    
    const chatsSection = document.getElementById('chatsSection');
    
    

    // ... (keep the existing showBattles, showRequests, and showStats functions)

    function showChats() {
        chatsSection.classList.remove('hidden');
        

        // Sample chat data (replace with actual data from your backend)
        const chats = [
            { id: 1, name: "Naruto Uzumaki", lastMessage: "Let's train together!", unread: 2 },
            { id: 2, name: "Sasuke Uchiha", lastMessage: "I challenge you to a duel.", unread: 0 },
            { id: 3, name: "Sakura Haruno", lastMessage: "Need help with medical ninjutsu?", unread: 1 },
            { id: 4, name: "Kakashi Hatake", lastMessage: "Team meeting tomorrow.", unread: 0 },
        ];

        const chatList = document.getElementById('chatList');
        chatList.innerHTML = chats.map(chat => createChatListItem(chat)).join('');

        // Add click event listeners to chat list items
        document.querySelectorAll('.chat-list-item').forEach(item => {
            item.addEventListener('click', () => selectChat(item.dataset.chatId));
        });

        // Mobile chat toggle functionality
        const mobileChatToggle = document.getElementById('mobileChatToggle');
        const chatWindow = document.getElementById('chatWindow');
        mobileChatToggle.addEventListener('click', () => {
            chatWindow.classList.toggle('hidden');
            chatWindow.classList.toggle('flex');
        });
    }

    function createChatListItem(chat) {
        return `
            <div class="chat-list-item flex items-center p-4 border-b border-gray-700 hover:bg-gray-700 cursor-pointer transition duration-300" data-chat-id="${chat.id}">
                <div class="w-12 h-12 bg-indigo-600 rounded-full flex items-center justify-center mr-4">
                    <span class="text-xl font-bold">${chat.name.charAt(0)}</span>
                </div>
                <div class="flex-grow">
                    <h4 class="font-bold">${chat.name}</h4>
                    <p class="text-sm text-gray-400">${chat.lastMessage}</p>
                </div>
                ${chat.unread > 0 ? `<div class="bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center">${chat.unread}</div>` : ''}
            </div>
        `;
    }

    function selectChat(chatId) {
        console.log(`Chat ${chatId} selected`);
        // Here you would typically load the chat messages for the selected chat
        // and update the chat window accordingly

        // For demonstration, we'll just update the header and show some sample messages
        const chatHeader = document.getElementById('chatHeader');
        const chatMessages = document.getElementById('chatMessages');
        const selectedChat = document.querySelector(`.chat-list-item[data-chat-id="${chatId}"]`);
        const chatName = selectedChat.querySelector('h4').textContent;

        chatHeader.innerHTML = `<h3 class="text-xl font-bold">${chatName}</h3>`;
        chatMessages.innerHTML = `
            <div class="mb-4">
                <p class="bg-gray-700 rounded-lg p-2 inline-block">Hey there! Ready for our mission?</p>
            </div>
            <div class="mb-4 text-right">
                <p class="bg-indigo-600 rounded-lg p-2 inline-block">Absolutely! What's the plan?</p>
            </div>
            <div class="mb-4">
                <p class="bg-gray-700 rounded-lg p-2 inline-block">Let's meet at the village gate in 10 minutes.</p>
            </div>
        `;

        // Show chat window on mobile when a chat is selected
        const chatWindow = document.getElementById('chatWindow');
        chatWindow.classList.remove('hidden');
        chatWindow.classList.add('flex');
    }

    // Message sending functionality
    const messageForm = document.getElementById('messageForm');
    const messageInput = document.getElementById('messageInput');

    messageForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const message = messageInput.value.trim();
        if (message) {
            sendMessage(message);
            messageInput.value = '';
        }
    });

    function sendMessage(message) {
        const chatMessages = document.getElementById('chatMessages');
        const messageElement = document.createElement('div');
        messageElement.className = 'mb-4 text-right';
        messageElement.innerHTML = `
            <p class="bg-indigo-600 rounded-lg p-2 inline-block">${message}</p>
        `;
        chatMessages.appendChild(messageElement);
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // Initialize with battles shown
    showChats();
</script>

{%  endblock not_fetchContent %}
{% endblock not_filterContent %}